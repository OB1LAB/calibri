{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useMemo,useContext}from\"react\";import SelectServer from\"../components/Selectors/SelectServer\";import SelectCategories from\"../components/Selectors/SelectCategories\";import ItemsList from\"../components/MarketItems/ItemsList\";import Loader from\"../components/Loader/Loader\";import\"../styles/Market.css\";import{Context}from\"..\";import SelectTypeItems from\"../components/Selectors/SelectTypeItems\";import MarketService from\"../services/MarketService\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function MarketPage(){var _useContext=useContext(Context),store=_useContext.store;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),items=_useState2[0],setItems=_useState2[1];var _useState3=useState(\"donate\"),_useState4=_slicedToArray(_useState3,2),typeItem=_useState4[0],setTypeItem=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),categoriesFilter=_useState6[0],setCategoriesFilter=_useState6[1];var _useState7=useState(\"dt\"),_useState8=_slicedToArray(_useState7,2),selectedServer=_useState8[0],setselectedServer=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),search=_useState10[0],setSearch=_useState10[1];useEffect(function(){var setMarket=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return MarketService.fetchMarket();case 2:response=_context.sent;response&&setItems(response.data);case 4:case\"end\":return _context.stop();}}},_callee);}));return function setMarket(){return _ref.apply(this,arguments);};}();setMarket();document.title=\"Магазин\";},[]);var marketItems=useMemo(function(){if(Object.keys(items).length===0){return[];}else if(typeItem===\"items\"){if(categoriesFilter.length>0){var sortList=[];categoriesFilter.map(function(cat){return sortList.push(cat[\"value\"]);});return items[selectedServer].filter(function(item){return sortList.includes(item[\"cat\"]);});}else{return items[selectedServer];}}return items[typeItem];},[categoriesFilter,items,selectedServer,typeItem]);var filteredAndSearchedItems=useMemo(function(){return marketItems.filter(function(item){return item[\"viewName\"].toLowerCase().includes(search.toLowerCase());});},[search,marketItems]);if(Object.keys(items).length===0){return/*#__PURE__*/_jsx(Loader,{});}return/*#__PURE__*/_jsxs(\"div\",{className:\"market\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"selector\",children:/*#__PURE__*/_jsx(SelectServer,{onChange:function onChange(_ref2){var value=_ref2.value;setCategoriesFilter([]);setselectedServer(value);}})}),/*#__PURE__*/_jsx(\"input\",{className:\"find\",placeholder:\"\\u041F\\u043E\\u0438\\u0441\\u043A...\",onChange:function onChange(e){return setSearch(e.target.value);}}),/*#__PURE__*/_jsx(SelectTypeItems,{itemType:typeItem,setType:setTypeItem}),typeItem===\"items\"&&/*#__PURE__*/_jsx(\"div\",{className:\"selector\",children:/*#__PURE__*/_jsx(SelectCategories,{categoriesFilter:categoriesFilter,selectedServer:selectedServer,onChange:function onChange(value){setCategoriesFilter(value);}})}),/*#__PURE__*/_jsx(ItemsList,{selectedServer:selectedServer,user:store.user,items:filteredAndSearchedItems})]});}","map":{"version":3,"names":["React","useState","useEffect","useMemo","useContext","SelectServer","SelectCategories","ItemsList","Loader","Context","SelectTypeItems","MarketService","MarketPage","store","items","setItems","typeItem","setTypeItem","categoriesFilter","setCategoriesFilter","selectedServer","setselectedServer","search","setSearch","setMarket","fetchMarket","response","data","document","title","marketItems","Object","keys","length","sortList","map","cat","push","filter","item","includes","filteredAndSearchedItems","toLowerCase","value","e","target","user"],"sources":["C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/src/pages/MarketPage.jsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, useContext } from \"react\";\r\nimport SelectServer from \"../components/Selectors/SelectServer\";\r\nimport SelectCategories from \"../components/Selectors/SelectCategories\";\r\nimport ItemsList from \"../components/MarketItems/ItemsList\";\r\nimport Loader from \"../components/Loader/Loader\";\r\nimport \"../styles/Market.css\";\r\nimport { Context } from \"..\";\r\nimport SelectTypeItems from \"../components/Selectors/SelectTypeItems\";\r\nimport MarketService from \"../services/MarketService\";\r\n\r\nexport default function MarketPage() {\r\n  const { store } = useContext(Context);\r\n  const [items, setItems] = useState({});\r\n  const [typeItem, setTypeItem] = useState(\"donate\");\r\n  const [categoriesFilter, setCategoriesFilter] = useState([]);\r\n  const [selectedServer, setselectedServer] = useState(\"dt\");\r\n  const [search, setSearch] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    const setMarket = async () => {\r\n      const response = await MarketService.fetchMarket();\r\n      response && setItems(response.data);\r\n    };\r\n    setMarket();\r\n    document.title = \"Магазин\";\r\n  }, []);\r\n\r\n  const marketItems = useMemo(() => {\r\n    if (Object.keys(items).length === 0) {\r\n      return [];\r\n    } else if (typeItem === \"items\") {\r\n      if (categoriesFilter.length > 0) {\r\n        let sortList = [];\r\n        categoriesFilter.map((cat) => {\r\n          return sortList.push(cat[\"value\"]);\r\n        });\r\n        return items[selectedServer].filter((item) =>\r\n          sortList.includes(item[\"cat\"])\r\n        );\r\n      } else {\r\n        return items[selectedServer];\r\n      }\r\n    }\r\n    return items[typeItem];\r\n  }, [categoriesFilter, items, selectedServer, typeItem]);\r\n\r\n  const filteredAndSearchedItems = useMemo(() => {\r\n    return marketItems.filter((item) =>\r\n      item[\"viewName\"].toLowerCase().includes(search.toLowerCase())\r\n    );\r\n  }, [search, marketItems]);\r\n\r\n  if (Object.keys(items).length === 0) {\r\n    return <Loader />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"market\">\r\n      <div className=\"selector\">\r\n        <SelectServer\r\n          onChange={({ value }) => {\r\n            setCategoriesFilter([]);\r\n            setselectedServer(value);\r\n          }}\r\n        />\r\n      </div>\r\n      <input\r\n        className=\"find\"\r\n        placeholder=\"Поиск...\"\r\n        onChange={(e) => setSearch(e.target.value)}\r\n      ></input>\r\n      <SelectTypeItems itemType={typeItem} setType={setTypeItem} />\r\n      {typeItem === \"items\" && (\r\n        <div className=\"selector\">\r\n          <SelectCategories\r\n            categoriesFilter={categoriesFilter}\r\n            selectedServer={selectedServer}\r\n            onChange={(value) => {\r\n              setCategoriesFilter(value);\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n      <ItemsList\r\n        selectedServer={selectedServer}\r\n        user={store.user}\r\n        items={filteredAndSearchedItems}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}