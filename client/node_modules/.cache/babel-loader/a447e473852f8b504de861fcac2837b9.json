{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{makeAutoObservable}from\"mobx\";import AuthService from\"../services/AuthService\";import axios from\"axios\";import{API_URL}from\"../http\";var UserStore=/*#__PURE__*/function(){function UserStore(){_classCallCheck(this,UserStore);this.user={};this.isAuth=false;this.isLoading=true;makeAutoObservable(this);}_createClass(UserStore,[{key:\"setAuth\",value:function setAuth(bool){this.isAuth=bool;}},{key:\"setUser\",value:function setUser(user){this.user=user;}},{key:\"setIsLoading\",value:function setIsLoading(bool){this.isLoading=bool;}},{key:\"login\",value:function(){var _login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(code){var response,_e$response,_e$response$data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return AuthService.login(code);case 3:response=_context.sent;localStorage.setItem(\"token\",response.data.accessToken);this.setUser(response.data.user);this.setAuth(true);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);console.log((_e$response=_context.t0.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.message);case 12:case\"end\":return _context.stop();}}},_callee,this,[[0,9]]);}));function login(_x){return _login.apply(this,arguments);}return login;}()},{key:\"logout\",value:function(){var _logout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _e$response2,_e$response2$data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return AuthService.logout();case 3:localStorage.removeItem(\"token\");this.setAuth(false);this.setUser({});_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.log((_e$response2=_context2.t0.response)===null||_e$response2===void 0?void 0:(_e$response2$data=_e$response2.data)===null||_e$response2$data===void 0?void 0:_e$response2$data.message);case 11:case\"end\":return _context2.stop();}}},_callee2,this,[[0,8]]);}));function logout(){return _logout.apply(this,arguments);}return logout;}()},{key:\"checkAuth\",value:function(){var _checkAuth=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var response,_e$response3,_e$response3$data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.get(\"\".concat(API_URL,\"/refreshToken\"),{withCredentials:true});case 3:response=_context3.sent;localStorage.setItem(\"token\",response.data.accessToken);this.setUser(response.data.user);this.setAuth(true);_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);console.log((_e$response3=_context3.t0.response)===null||_e$response3===void 0?void 0:(_e$response3$data=_e$response3.data)===null||_e$response3$data===void 0?void 0:_e$response3$data.message);case 12:_context3.prev=12;this.setIsLoading(false);return _context3.finish(12);case 15:case\"end\":return _context3.stop();}}},_callee3,this,[[0,9,12,15]]);}));function checkAuth(){return _checkAuth.apply(this,arguments);}return checkAuth;}()}]);return UserStore;}();export{UserStore as default};","map":{"version":3,"names":["makeAutoObservable","AuthService","axios","API_URL","UserStore","user","isAuth","isLoading","bool","code","login","response","localStorage","setItem","data","accessToken","setUser","setAuth","console","log","message","logout","removeItem","get","withCredentials","setIsLoading"],"sources":["C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/src/store/UserStore.js"],"sourcesContent":["import { makeAutoObservable } from \"mobx\";\r\nimport AuthService from \"../services/AuthService\";\r\nimport axios from \"axios\";\r\nimport { API_URL } from \"../http\";\r\n\r\nexport default class UserStore {\r\n  user = {};\r\n  isAuth = false;\r\n  isLoading = true;\r\n\r\n  constructor() {\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  setAuth(bool) {\r\n    this.isAuth = bool;\r\n  }\r\n\r\n  setUser(user) {\r\n    this.user = user;\r\n  }\r\n\r\n  setIsLoading(bool) {\r\n    this.isLoading = bool;\r\n  }\r\n\r\n  async login(code) {\r\n    try {\r\n      const response = await AuthService.login(code);\r\n      localStorage.setItem(\"token\", response.data.accessToken);\r\n      this.setUser(response.data.user);\r\n      this.setAuth(true);\r\n    } catch (e) {\r\n      console.log(e.response?.data?.message);\r\n    }\r\n  }\r\n\r\n  async logout() {\r\n    try {\r\n      await AuthService.logout();\r\n      localStorage.removeItem(\"token\");\r\n      this.setAuth(false);\r\n      this.setUser({});\r\n    } catch (e) {\r\n      console.log(e.response?.data?.message);\r\n    }\r\n  }\r\n\r\n  async checkAuth() {\r\n    try {\r\n      const response = await axios.get(`${API_URL}/refreshToken`, {\r\n        withCredentials: true,\r\n      });\r\n      localStorage.setItem(\"token\", response.data.accessToken);\r\n      this.setUser(response.data.user);\r\n      this.setAuth(true);\r\n    } catch (e) {\r\n      console.log(e.response?.data?.message);\r\n    } finally {\r\n      this.setIsLoading(false);\r\n    }\r\n  }\r\n}\r\n"],"mappings":"sjBAAA,OAASA,kBAAkB,KAAQ,MAAM,CACzC,MAAOC,YAAW,KAAM,yBAAyB,CACjD,MAAOC,MAAK,KAAM,OAAO,CACzB,OAASC,OAAO,KAAQ,SAAS,CAAC,GAEbC,UAAS,yBAK5B,oBAAc,sCAJdC,IAAI,CAAG,CAAC,CAAC,MACTC,MAAM,CAAG,KAAK,MACdC,SAAS,CAAG,IAAI,CAGdP,kBAAkB,CAAC,IAAI,CAAC,CAC1B,CAAC,6CAED,iBAAQQ,IAAI,CAAE,CACZ,IAAI,CAACF,MAAM,CAAGE,IAAI,CACpB,CAAC,uBAED,iBAAQH,IAAI,CAAE,CACZ,IAAI,CAACA,IAAI,CAAGA,IAAI,CAClB,CAAC,4BAED,sBAAaG,IAAI,CAAE,CACjB,IAAI,CAACD,SAAS,CAAGC,IAAI,CACvB,CAAC,qGAED,iBAAYC,IAAI,oMAEWR,YAAW,CAACS,KAAK,CAACD,IAAI,CAAC,QAAxCE,QAAQ,eACdC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAEF,QAAQ,CAACG,IAAI,CAACC,WAAW,CAAC,CACxD,IAAI,CAACC,OAAO,CAACL,QAAQ,CAACG,IAAI,CAACT,IAAI,CAAC,CAChC,IAAI,CAACY,OAAO,CAAC,IAAI,CAAC,CAAC,+EAEnBC,OAAO,CAACC,GAAG,cAAC,YAAER,QAAQ,wDAAV,YAAYG,IAAI,2CAAhB,iBAAkBM,OAAO,CAAC,CAAC,oEAE1C,kLAED,qNAEUnB,YAAW,CAACoB,MAAM,EAAE,QAC1BT,YAAY,CAACU,UAAU,CAAC,OAAO,CAAC,CAChC,IAAI,CAACL,OAAO,CAAC,KAAK,CAAC,CACnB,IAAI,CAACD,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,mFAEjBE,OAAO,CAACC,GAAG,eAAC,aAAER,QAAQ,0DAAV,aAAYG,IAAI,4CAAhB,kBAAkBM,OAAO,CAAC,CAAC,sEAE1C,yLAED,8NAE2BlB,MAAK,CAACqB,GAAG,WAAIpB,OAAO,kBAAiB,CAC1DqB,eAAe,CAAE,IACnB,CAAC,CAAC,QAFIb,QAAQ,gBAGdC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAEF,QAAQ,CAACG,IAAI,CAACC,WAAW,CAAC,CACxD,IAAI,CAACC,OAAO,CAACL,QAAQ,CAACG,IAAI,CAACT,IAAI,CAAC,CAChC,IAAI,CAACY,OAAO,CAAC,IAAI,CAAC,CAAC,mFAEnBC,OAAO,CAACC,GAAG,eAAC,aAAER,QAAQ,0DAAV,aAAYG,IAAI,4CAAhB,kBAAkBM,OAAO,CAAC,CAAC,0BAEvC,IAAI,CAACK,YAAY,CAAC,KAAK,CAAC,CAAC,wGAE5B,qHAxDkBrB,SAAS"},"metadata":{},"sourceType":"module"}