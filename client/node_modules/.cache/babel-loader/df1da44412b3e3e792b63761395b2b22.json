{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from\"axios\";export var API_URL=process.env.REACT_APP_SERVER_URL;var $api=axios.create({withCredentials:true,baseURL:API_URL});$api.interceptors.request.use(function(config){config.headers.Authorization=\"Bearer \".concat(localStorage.getItem(\"token\"));return config;});$api.interceptors.response.use(function(config){return config;},/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(error){var originalRequest,response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:originalRequest=error.config;if(!(error.response.status===401&&originalRequest&&!originalRequest._isRetry)){_context.next=14;break;}originalRequest._isRetry=true;_context.prev=3;_context.next=6;return axios.get(\"\".concat(API_URL,\"/refreshToken\"),{withCredentials:true});case 6:response=_context.sent;localStorage.setItem(\"token\",response.data.accessToken);return _context.abrupt(\"return\",$api.request(originalRequest));case 11:_context.prev=11;_context.t0=_context[\"catch\"](3);console.log(\"Not authorized \");case 14:throw error;case 15:case\"end\":return _context.stop();}}},_callee,null,[[3,11]]);}));return function(_x){return _ref.apply(this,arguments);};}());export default $api;","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_SERVER_URL","$api","create","withCredentials","baseURL","interceptors","request","use","config","headers","Authorization","localStorage","getItem","response","error","originalRequest","status","_isRetry","get","setItem","data","accessToken","console","log"],"sources":["C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/src/http/index.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\nexport const API_URL = process.env.REACT_APP_SERVER_URL;\r\n\r\nconst $api = axios.create({\r\n  withCredentials: true,\r\n  baseURL: API_URL,\r\n});\r\n\r\n$api.interceptors.request.use((config) => {\r\n  config.headers.Authorization = `Bearer ${localStorage.getItem(\"token\")}`;\r\n  return config;\r\n});\r\n\r\n$api.interceptors.response.use(\r\n  (config) => {\r\n    return config;\r\n  },\r\n  async (error) => {\r\n    const originalRequest = error.config;\r\n    if (\r\n      error.response.status === 401 &&\r\n      originalRequest &&\r\n      !originalRequest._isRetry\r\n    ) {\r\n      originalRequest._isRetry = true;\r\n      try {\r\n        const response = await axios.get(`${API_URL}/refreshToken`, {\r\n          withCredentials: true,\r\n        });\r\n        localStorage.setItem(\"token\", response.data.accessToken);\r\n        return $api.request(originalRequest);\r\n      } catch (e) {\r\n        console.log(\"Not authorized \");\r\n      }\r\n    }\r\n    throw error;\r\n  }\r\n);\r\n\r\nexport default $api;\r\n"],"mappings":"oSAAA,MAAOA,MAAK,KAAM,OAAO,CAEzB,MAAO,IAAMC,QAAO,CAAGC,OAAO,CAACC,GAAG,CAACC,oBAAoB,CAEvD,GAAMC,KAAI,CAAGL,KAAK,CAACM,MAAM,CAAC,CACxBC,eAAe,CAAE,IAAI,CACrBC,OAAO,CAAEP,OACX,CAAC,CAAC,CAEFI,IAAI,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,SAACC,MAAM,CAAK,CACxCA,MAAM,CAACC,OAAO,CAACC,aAAa,kBAAaC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAAE,CACxE,MAAOJ,OAAM,CACf,CAAC,CAAC,CAEFP,IAAI,CAACI,YAAY,CAACQ,QAAQ,CAACN,GAAG,CAC5B,SAACC,MAAM,CAAK,CACV,MAAOA,OAAM,CACf,CAAC,4FACD,iBAAOM,KAAK,iJACJC,eAAe,CAAGD,KAAK,CAACN,MAAM,MAElCM,KAAK,CAACD,QAAQ,CAACG,MAAM,GAAK,GAAG,EAC7BD,eAAe,EACf,CAACA,eAAe,CAACE,QAAQ,2BAEzBF,eAAe,CAACE,QAAQ,CAAG,IAAI,CAAC,sCAEPrB,MAAK,CAACsB,GAAG,WAAIrB,OAAO,kBAAiB,CAC1DM,eAAe,CAAE,IACnB,CAAC,CAAC,QAFIU,QAAQ,eAGdF,YAAY,CAACQ,OAAO,CAAC,OAAO,CAAEN,QAAQ,CAACO,IAAI,CAACC,WAAW,CAAC,CAAC,gCAClDpB,IAAI,CAACK,OAAO,CAACS,eAAe,CAAC,4DAEpCO,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC,CAAC,aAG7BT,MAAK,sEACZ,+DACF,CAED,cAAeb,KAAI"},"metadata":{},"sourceType":"module"}