{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useMemo,useContext}from\"react\";import SelectServer from\"../components/Selectors/SelectServer\";import SelectCategories from\"../components/Selectors/SelectCategories\";import ItemsList from\"../components/MarketItems/ItemsList\";import Loader from\"../components/Loader/Loader\";import\"../styles/Market.css\";import{Context}from\"..\";import SelectTypeItems from\"../components/Selectors/SelectTypeItems\";import MarketService from\"../services/MarketService\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function MarketPage(){var server=\"\";var _useContext=useContext(Context),store=_useContext.store;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),items=_useState2[0],setItems=_useState2[1];var _useState3=useState(\"donate\"),_useState4=_slicedToArray(_useState3,2),typeItem=_useState4[0],setTypeItem=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),categoriesFilter=_useState6[0],setCategoriesFilter=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),search=_useState8[0],setSearch=_useState8[1];if(store.user[\"dt\"][\"lvl\"]>1&&store.user[\"tmrpg\"][\"lvl\"]>1){server=\"dt\";}else{if(store.user[\"dt\"][\"lvl\"]>1){server=\"dt\";}else if(store.user[\"tmrpg\"][\"lvl\"]>1){server=\"tmrpg\";}}var _useState9=useState(server),_useState10=_slicedToArray(_useState9,2),selectedServer=_useState10[0],setselectedServer=_useState10[1];useEffect(function(){var setMarket=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return MarketService.fetchMarket();case 2:response=_context.sent;response&&setItems(response.data);case 4:case\"end\":return _context.stop();}}},_callee);}));return function setMarket(){return _ref.apply(this,arguments);};}();setMarket();document.title=\"Магазин\";},[]);var marketItems=useMemo(function(){if(Object.keys(items).length===0){return[];}else if(typeItem===\"items\"){if(categoriesFilter.length>0){var sortList=[];categoriesFilter.map(function(cat){return sortList.push(cat[\"value\"]);});return items[selectedServer].filter(function(item){return sortList.includes(item[\"cat\"]);});}else{return items[selectedServer];}}return items[typeItem];},[categoriesFilter,items,selectedServer,typeItem]);var filteredAndSearchedItems=useMemo(function(){return marketItems.filter(function(item){return item[\"viewName\"].toLowerCase().includes(search.toLowerCase());});},[search,marketItems]);if(Object.keys(items).length===0){return/*#__PURE__*/_jsx(Loader,{});}return/*#__PURE__*/_jsxs(\"div\",{className:\"market\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"selector\",children:store.user[\"dt\"][\"lvl\"]>1&&store.user[\"tmrpg\"][\"lvl\"]>1&&/*#__PURE__*/_jsx(SelectServer,{onChange:function onChange(_ref2){var value=_ref2.value;setCategoriesFilter([]);setselectedServer(value);}})}),/*#__PURE__*/_jsx(\"input\",{className:\"find\",placeholder:\"\\u041F\\u043E\\u0438\\u0441\\u043A...\",onChange:function onChange(e){return setSearch(e.target.value);}}),/*#__PURE__*/_jsx(SelectTypeItems,{itemType:typeItem,setType:setTypeItem}),typeItem===\"items\"&&/*#__PURE__*/_jsx(\"div\",{className:\"selector\",children:/*#__PURE__*/_jsx(SelectCategories,{categoriesFilter:categoriesFilter,selectedServer:selectedServer,onChange:function onChange(value){setCategoriesFilter(value);}})}),/*#__PURE__*/_jsx(ItemsList,{selectedServer:selectedServer,user:store.user,items:filteredAndSearchedItems})]});}","map":{"version":3,"names":["React","useState","useEffect","useMemo","useContext","SelectServer","SelectCategories","ItemsList","Loader","Context","SelectTypeItems","MarketService","MarketPage","server","store","items","setItems","typeItem","setTypeItem","categoriesFilter","setCategoriesFilter","search","setSearch","user","selectedServer","setselectedServer","setMarket","fetchMarket","response","data","document","title","marketItems","Object","keys","length","sortList","map","cat","push","filter","item","includes","filteredAndSearchedItems","toLowerCase","value","e","target"],"sources":["C:/Users/OB1CHAM/Desktop/OB1LAB/React/calibri/client/src/pages/MarketPage.jsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, useContext } from \"react\";\r\nimport SelectServer from \"../components/Selectors/SelectServer\";\r\nimport SelectCategories from \"../components/Selectors/SelectCategories\";\r\nimport ItemsList from \"../components/MarketItems/ItemsList\";\r\nimport Loader from \"../components/Loader/Loader\";\r\nimport \"../styles/Market.css\";\r\nimport { Context } from \"..\";\r\nimport SelectTypeItems from \"../components/Selectors/SelectTypeItems\";\r\nimport MarketService from \"../services/MarketService\";\r\n\r\nexport default function MarketPage() {\r\n  let server = \"\";\r\n  const { store } = useContext(Context);\r\n  const [items, setItems] = useState({});\r\n  const [typeItem, setTypeItem] = useState(\"donate\");\r\n  const [categoriesFilter, setCategoriesFilter] = useState([]);\r\n  const [search, setSearch] = useState(\"\");\r\n\r\n  if (store.user[\"dt\"][\"lvl\"] > 1 && store.user[\"tmrpg\"][\"lvl\"] > 1) {\r\n    server = \"dt\";\r\n  } else {\r\n    if (store.user[\"dt\"][\"lvl\"] > 1) {\r\n      server = \"dt\";\r\n    } else if (store.user[\"tmrpg\"][\"lvl\"] > 1) {\r\n      server = \"tmrpg\";\r\n    }\r\n  }\r\n  const [selectedServer, setselectedServer] = useState(server);\r\n\r\n  useEffect(() => {\r\n    const setMarket = async () => {\r\n      const response = await MarketService.fetchMarket();\r\n      response && setItems(response.data);\r\n    };\r\n    setMarket();\r\n    document.title = \"Магазин\";\r\n  }, []);\r\n\r\n  const marketItems = useMemo(() => {\r\n    if (Object.keys(items).length === 0) {\r\n      return [];\r\n    } else if (typeItem === \"items\") {\r\n      if (categoriesFilter.length > 0) {\r\n        let sortList = [];\r\n        categoriesFilter.map((cat) => {\r\n          return sortList.push(cat[\"value\"]);\r\n        });\r\n        return items[selectedServer].filter((item) =>\r\n          sortList.includes(item[\"cat\"])\r\n        );\r\n      } else {\r\n        return items[selectedServer];\r\n      }\r\n    }\r\n    return items[typeItem];\r\n  }, [categoriesFilter, items, selectedServer, typeItem]);\r\n\r\n  const filteredAndSearchedItems = useMemo(() => {\r\n    return marketItems.filter((item) =>\r\n      item[\"viewName\"].toLowerCase().includes(search.toLowerCase())\r\n    );\r\n  }, [search, marketItems]);\r\n\r\n  if (Object.keys(items).length === 0) {\r\n    return <Loader />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"market\">\r\n      <div className=\"selector\">\r\n        {store.user[\"dt\"][\"lvl\"] > 1 && store.user[\"tmrpg\"][\"lvl\"] > 1 && (\r\n          <SelectServer\r\n            onChange={({ value }) => {\r\n              setCategoriesFilter([]);\r\n              setselectedServer(value);\r\n            }}\r\n          />\r\n        )}\r\n      </div>\r\n      <input\r\n        className=\"find\"\r\n        placeholder=\"Поиск...\"\r\n        onChange={(e) => setSearch(e.target.value)}\r\n      ></input>\r\n      <SelectTypeItems itemType={typeItem} setType={setTypeItem} />\r\n      {typeItem === \"items\" && (\r\n        <div className=\"selector\">\r\n          <SelectCategories\r\n            categoriesFilter={categoriesFilter}\r\n            selectedServer={selectedServer}\r\n            onChange={(value) => {\r\n              setCategoriesFilter(value);\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n      <ItemsList\r\n        selectedServer={selectedServer}\r\n        user={store.user}\r\n        items={filteredAndSearchedItems}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}